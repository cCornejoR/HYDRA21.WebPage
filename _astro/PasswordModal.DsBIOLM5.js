import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.BVOCwoKb.js";const g="cf596c7d3eb0e9c26e799905c88e0939d8c1f3dda8637c7721f891efb480dbb9";async function j(t){const o=new TextEncoder().encode(t),c=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(c)).map(u=>u.toString(16).padStart(2,"0")).join("")}function k(){const t=new Uint8Array(32);return crypto.getRandomValues(t),Array.from(t,r=>r.toString(16).padStart(2,"0")).join("")}async function N(t){try{return t?await j(t)===g?!0:(await new Promise(o=>setTimeout(o,200)),!1):!1}catch(r){return console.error("Error en autenticación:",r),!1}}function E(){const[t,r]=a.useState(!1),[o,c]=a.useState(""),[n,u]=a.useState(!1),[f,d]=a.useState(""),[m,p]=a.useState(!1),[b,w]=a.useState("");a.useEffect(()=>{const s=x=>{w(x.detail?.downloadUrl||""),r(!0)},i=()=>{r(!1)};return window.addEventListener("show-auth-modal",s),window.addEventListener("hide-auth-modal",i),()=>{window.removeEventListener("show-auth-modal",s),window.removeEventListener("hide-auth-modal",i)}},[]),a.useEffect(()=>{t&&(c(""),d(""),p(!1),setTimeout(()=>{const s=document.getElementById("global-password-input");s&&s.focus()},100))},[t]),a.useEffect(()=>{const s=i=>{i.key==="Escape"&&t&&h()};return t&&(document.addEventListener("keydown",s),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",s),document.body.style.overflow="unset"}},[t]);const y=async s=>{if(s.preventDefault(),!o.trim()){d("Por favor ingresa la contraseña");return}u(!0),d("");try{if(await N(o)){const x=k(),v=Date.now();sessionStorage.setItem("hydra_download_token",x),sessionStorage.setItem("hydra_download_auth","true"),sessionStorage.setItem("hydra_download_timestamp",v.toString()),window.dispatchEvent(new CustomEvent("auth-success")),r(!1),b&&setTimeout(()=>{const l=document.createElement("a");l.href=b,l.download="",l.target="_blank",l.rel="noopener noreferrer",document.body.appendChild(l),l.click(),document.body.removeChild(l)},200)}else d("Contraseña incorrecta")}catch(i){console.error("Error de autenticación:",i),d("Error de verificación. Inténtalo de nuevo.")}finally{u(!1)}},h=()=>{n||(r(!1),w(""))};return t?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-xl",onClick:h,style:{backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"}}),e.jsxs("div",{className:"relative bg-gray-900/95 border border-blue-500/30 rounded-3xl p-8 max-w-md w-full mx-4 shadow-2xl shadow-blue-500/20 backdrop-blur-lg",children:[e.jsx("button",{onClick:h,disabled:n,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors disabled:opacity-50",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-500/20 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Acceso Restringido"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Ingresa la contraseña para acceder a las descargas de HYDRA²¹"})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"global-password-input",className:"block text-sm font-medium text-gray-300 mb-2",children:"Contraseña de Descarga"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"global-password-input",type:m?"text":"password",value:o,onChange:s=>c(s.target.value),disabled:n,className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors disabled:opacity-50 pr-12",placeholder:"Ingresa la contraseña...",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>p(!m),disabled:n,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors disabled:opacity-50",children:m?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),f&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/50 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-red-400 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.864-.833-2.634 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("p",{className:"text-red-300 text-sm",children:f})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:h,disabled:n,className:"btn-secondary flex-1 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:n||!o.trim(),className:"btn-secondary flex-1 disabled:opacity-50 disabled:hover:scale-100 disabled:cursor-not-allowed flex items-center justify-center",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verificando..."]}):"Acceder"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["¿No tienes la contraseña?"," ",e.jsx("a",{href:"mailto:support@hydra21.com",className:"text-blue-400 hover:text-blue-300 underline",children:"Contáctanos"})]})})]})]}):null}export{E as default};
