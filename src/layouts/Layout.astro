---
import { ClientRouter } from "astro:transitions";

export interface Props {
  title: string;
  description?: string;
}

const { title, description = "HYDRA²¹ - Software de Ingeniería Hidráulica" } = Astro.props;
---

<!DOCTYPE html>
<html lang="es" class="h-full" transition:name="root">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/pipe_logo.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <!-- Enhanced View Transitions with optimized configuration -->
    <ClientRouter fallback="animate" />

    <!-- Preload critical resources for faster transitions -->
    <link rel="preload" href="/assets/images/cube_2.png" as="image" />
    <link rel="preload" href="/assets/images/torus_2.png" as="image" />
    <link rel="preload" href="/assets/images/icosahedron_2.png" as="image" />
  </head>
  <body class="h-full font-body antialiased theme-bg theme-text transition-colors duration-300 min-w-[300px]" style="min-height: 100vh; min-height: 100svh;">
    <div class="min-h-screen relative min-w-[300px]" style="min-height: 100vh; min-height: 100svh;">
      <!-- Enhanced Background with diagonal grid pattern -->
      <div class="absolute inset-0 diagonal-grid opacity-60"></div>

      <!-- Responsive background decorative elements following Hero patterns -->
      <!-- Top-left decorative element -->
      <div class="absolute top-6 left-6 sm:top-10 sm:left-10 md:top-20 md:left-20 w-32 h-32 sm:w-48 sm:h-48 md:w-72 md:h-72 lg:w-80 lg:h-80 xl:w-96 xl:h-96 bg-blue-600/8 dark:bg-blue-600/6 rounded-full blur-3xl animate-pulse-slow"></div>

      <!-- Bottom-right decorative element -->
      <div class="absolute bottom-6 right-6 sm:bottom-10 sm:right-10 md:bottom-20 md:right-20 w-40 h-40 sm:w-64 sm:h-64 md:w-96 md:h-96 lg:w-[28rem] lg:h-[28rem] xl:w-[32rem] xl:h-[32rem] bg-sky-500/8 dark:bg-sky-500/6 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: -2s;"></div>

      <!-- Central decorative element -->
      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 sm:w-80 sm:h-80 md:w-[500px] md:h-[500px] lg:w-[600px] lg:h-[600px] xl:w-[700px] xl:h-[700px] 2xl:w-[800px] 2xl:h-[800px] bg-blue-400/6 dark:bg-blue-400/4 rounded-full blur-3xl"></div>

      <!-- Top-right accent element -->
      <div class="absolute top-1/4 right-1/4 w-24 h-24 sm:w-32 sm:h-32 md:w-48 md:h-48 lg:w-56 lg:h-56 xl:w-64 xl:h-64 bg-indigo-500/6 dark:bg-indigo-500/4 rounded-full blur-2xl animate-float-slow"></div>

      <main class="relative z-10" transition:name="main-content">
        <slot />
      </main>
    </div>

    <!-- Enhanced View Transitions Loading Elements -->
    <div class="page-loading-bar" id="page-loading-bar"></div>
    <div class="page-transition-overlay" id="page-transition-overlay"></div>

    <!-- Theme Toggle Script con soporte para transiciones -->
    <script is:inline>
      // Función para aplicar el tema (requerido para transiciones)
      function applyTheme() {
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = savedTheme || (prefersDark ? 'dark' : 'light');
        
        document.documentElement.classList.remove('light', 'dark');
        document.documentElement.classList.add(theme);
        
        return theme;
      }

      // Theme toggle functionality
      function initTheme() {
        const theme = applyTheme();
        localStorage.setItem('theme', theme);
      }

      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        // Remove both classes and add the new one
        html.classList.remove('light', 'dark');
        html.classList.add(newTheme);
        
        // Save preference
        localStorage.setItem('theme', newTheme);
        
        // Trigger a custom event for other components to listen to
        window.dispatchEvent(new CustomEvent('themeChanged', { 
          detail: { theme: newTheme } 
        }));
      }

      // Initialize theme immediately to prevent flash
      applyTheme();

      // Aplicar tema después de cada transición de página
      document.addEventListener("astro:after-swap", applyTheme);
      
      // Initialize on load and after navigation
      document.addEventListener('DOMContentLoaded', initTheme);
      document.addEventListener("astro:page-load", initTheme);

      // Make toggleTheme available globally
      window.toggleTheme = toggleTheme;
    </script>

    <!-- Enhanced View Transitions Script -->
    <script is:inline>
      // Enhanced View Transitions with loading states and performance optimization
      class EnhancedViewTransitions {
        constructor() {
          this.loadingBar = document.getElementById('page-loading-bar');
          this.overlay = document.getElementById('page-transition-overlay');
          this.isTransitioning = false;
          this.init();
        }

        init() {
          // Listen for view transition events
          document.addEventListener('astro:before-preparation', this.handleBeforePreparation.bind(this));
          document.addEventListener('astro:after-preparation', this.handleAfterPreparation.bind(this));
          document.addEventListener('astro:before-swap', this.handleBeforeSwap.bind(this));
          document.addEventListener('astro:after-swap', this.handleAfterSwap.bind(this));
          document.addEventListener('astro:page-load', this.handlePageLoad.bind(this));

          // Preload critical resources
          this.preloadCriticalResources();
        }

        handleBeforePreparation(event) {
          if (this.isTransitioning) return;
          this.isTransitioning = true;

          // Show loading indicators
          this.showLoadingState();

          // Add custom loading logic
          const originalLoader = event.loader;
          event.loader = async function() {
            try {
              await originalLoader();
            } catch (error) {
              console.warn('Page loading error:', error);
              // Fallback to regular navigation
              window.location.href = event.to.href;
            }
          };
        }

        handleAfterPreparation() {
          // Preparation complete, ready for swap
          this.updateLoadingProgress(70);
        }

        handleBeforeSwap(event) {
          // Ensure theme consistency
          this.preserveThemeState(event.newDocument);
          this.updateLoadingProgress(90);
        }

        handleAfterSwap() {
          // DOM has been swapped
          this.updateLoadingProgress(95);

          // Re-initialize any necessary scripts
          this.reinitializeScripts();
        }

        handlePageLoad() {
          // Page fully loaded
          this.hideLoadingState();
          this.isTransitioning = false;

          // Trigger custom page load event for other scripts
          window.dispatchEvent(new CustomEvent('enhanced-page-load'));
        }

        showLoadingState() {
          if (this.loadingBar) {
            this.loadingBar.classList.add('active');
          }

          // Respect reduced motion
          if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            if (this.overlay) {
              this.overlay.classList.add('active');

              // Add elegant entrance animation
              setTimeout(() => {
                this.overlay.style.transform = 'scale(1.02)';
                this.overlay.style.filter = 'blur(0px)';
              }, 100);
            }
          }

          // Add page morphing effect
          this.addPageMorphingEffect();
        }

        addPageMorphingEffect() {
          const currentPage = document.body;
          if (currentPage) {
            currentPage.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            currentPage.style.transform = 'scale(0.96) rotateX(3deg) rotateY(-2deg)';
            currentPage.style.filter = 'blur(5px) brightness(0.7) saturate(1.3)';
            currentPage.style.opacity = '0.6';
          }
        }

        hideLoadingState() {
          if (this.loadingBar) {
            this.loadingBar.classList.remove('active');
          }
          if (this.overlay) {
            this.overlay.classList.remove('active');
            // Reset overlay styles
            this.overlay.style.transform = '';
            this.overlay.style.filter = '';
          }

          // Restore page state with elegant animation
          this.restorePageState();
        }

        restorePageState() {
          const currentPage = document.body;
          if (currentPage) {
            // Fast restoration with dramatic effect
            setTimeout(() => {
              currentPage.style.transform = 'scale(1.02) rotateX(-1deg) rotateY(1deg)';
              currentPage.style.filter = 'blur(0px) brightness(1.1) saturate(1.1)';
              currentPage.style.opacity = '1';

              // Settle to normal state
              setTimeout(() => {
                currentPage.style.transform = 'scale(1) rotateX(0deg) rotateY(0deg)';
                currentPage.style.filter = 'blur(0px) brightness(1) saturate(1)';

                // Clean up after final animation
                setTimeout(() => {
                  currentPage.style.transition = '';
                  currentPage.style.transform = '';
                  currentPage.style.filter = '';
                  currentPage.style.opacity = '';
                }, 300);
              }, 200);
            }, 30);
          }
        }

        updateLoadingProgress(percentage) {
          // Update loading progress if needed
          if (this.loadingBar) {
            this.loadingBar.style.setProperty('--progress', `${percentage}%`);
          }
        }

        preserveThemeState(newDocument) {
          // Preserve theme state across transitions
          const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
          if (currentTheme === 'dark') {
            newDocument.documentElement.classList.add('dark');
          } else {
            newDocument.documentElement.classList.remove('dark');
          }
        }

        reinitializeScripts() {
          // Re-trigger initialization for components that need it
          setTimeout(() => {
            // Trigger viewport animations refresh
            if (window.viewportAnimator) {
              window.viewportAnimator.refresh();
            }
          }, 100);
        }

        preloadCriticalResources() {
          // Preload critical images and resources
          const criticalImages = [
            '/assets/images/cube_2.png',
            '/assets/images/torus_2.png',
            '/assets/images/icosahedron_2.png'
          ];

          criticalImages.forEach(src => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'image';
            link.href = src;
            document.head.appendChild(link);
          });
        }
      }

      // Initialize enhanced view transitions
      let enhancedTransitions;

      function initEnhancedTransitions() {
        if (enhancedTransitions) return;
        enhancedTransitions = new EnhancedViewTransitions();
      }

      // Initialize on DOM ready and after page loads
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initEnhancedTransitions);
      } else {
        initEnhancedTransitions();
      }

      document.addEventListener('astro:page-load', initEnhancedTransitions);
    </script>
  </body>
</html>

<style>
  html {
    scroll-behavior: smooth;
  }

  /* Enhanced mobile optimizations following Hero patterns */
  @media (max-width: 768px) {
    body {
      font-size: 14px;
      line-height: 1.5;
    }

    /* Adjust decorative elements for mobile */
    .absolute.top-6 {
      top: 1rem !important;
      left: 1rem !important;
    }

    .absolute.bottom-6 {
      bottom: 1rem !important;
      right: 1rem !important;
    }
  }

  /* Mobile optimizations for screens ≤640px */
  @media (max-width: 640px) {
    /* Reduce decorative element sizes for better performance */
    .absolute.top-6 div,
    .absolute.bottom-6 div,
    .absolute.top-1\\/2 div,
    .absolute.top-1\\/4 div {
      animation-duration: 20s !important;
    }

    /* Simplify blur effects on mobile */
    .blur-3xl {
      backdrop-filter: blur(8px) !important;
    }

    .blur-2xl {
      backdrop-filter: blur(4px) !important;
    }
  }

  /* Enhanced optimizations for screens ≤499px following Hero pattern */
  @media (max-width: 499px) {
    /* Reduce decorative element opacity for better text contrast */
    .bg-blue-600\\/8,
    .bg-sky-500\\/8,
    .bg-blue-400\\/6,
    .bg-indigo-500\\/6 {
      opacity: 0.4 !important;
    }

    /* Ensure proper viewport height */
    body, html {
      min-height: 100vh !important;
      min-height: 100svh !important;
    }
  }

  /* Specific optimizations for screens <400px following Hero pattern */
  @media (max-width: 400px) {
    /* Further reduce decorative elements for very small screens */
    .absolute.top-6 {
      width: 4rem !important;
      height: 4rem !important;
    }

    .absolute.bottom-6 {
      width: 5rem !important;
      height: 5rem !important;
    }

    .absolute.top-1\\/2 {
      width: 8rem !important;
      height: 8rem !important;
    }

    .absolute.top-1\\/4 {
      width: 3rem !important;
      height: 3rem !important;
    }

    /* Reduce opacity further for better text readability */
    .bg-blue-600\\/8,
    .bg-sky-500\\/8,
    .bg-blue-400\\/6,
    .bg-indigo-500\\/6 {
      opacity: 0.2 !important;
    }

    /* Simplify animations for performance */
    .animate-pulse-slow,
    .animate-float-slow {
      animation-duration: 25s !important;
    }
  }

  /* Minimum width enforcement */
  body, html {
    min-width: 300px !important;
  }

  /* Smooth theme transitions */
  html {
    transition: background-color 0.3s ease;
  }

  body {
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  /* Ensure proper theme application */
  html {
    background-color: var(--color-background);
  }

  body {
    background-color: var(--color-background) !important;
    color: var(--color-foreground) !important;
  }

  /* ========================================
     PREMIUM ELEGANT VIEW TRANSITIONS
  ======================================== */

  /* Elegant morphing transitions */
  @keyframes elegant-fade-in {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.98);
      filter: blur(8px) brightness(0.8);
    }
    50% {
      opacity: 0.7;
      transform: translateY(10px) scale(0.99);
      filter: blur(4px) brightness(0.9);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0) brightness(1);
    }
  }

  @keyframes elegant-fade-out {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0) brightness(1);
    }
    50% {
      opacity: 0.7;
      transform: translateY(-10px) scale(1.01);
      filter: blur(2px) brightness(1.1);
    }
    100% {
      opacity: 0;
      transform: translateY(-20px) scale(1.02);
      filter: blur(8px) brightness(1.2);
    }
  }

  @keyframes premium-slide-in {
    0% {
      opacity: 0;
      transform: translateX(60px) rotateY(15deg) scale(0.95);
      filter: blur(10px) saturate(0.8);
    }
    30% {
      opacity: 0.4;
      transform: translateX(30px) rotateY(8deg) scale(0.97);
      filter: blur(6px) saturate(0.9);
    }
    70% {
      opacity: 0.8;
      transform: translateX(10px) rotateY(3deg) scale(0.99);
      filter: blur(2px) saturate(1);
    }
    100% {
      opacity: 1;
      transform: translateX(0) rotateY(0deg) scale(1);
      filter: blur(0) saturate(1);
    }
  }

  @keyframes premium-slide-out {
    0% {
      opacity: 1;
      transform: translateX(0) rotateY(0deg) scale(1);
      filter: blur(0) saturate(1);
    }
    30% {
      opacity: 0.8;
      transform: translateX(-10px) rotateY(-3deg) scale(1.01);
      filter: blur(2px) saturate(1.1);
    }
    70% {
      opacity: 0.4;
      transform: translateX(-30px) rotateY(-8deg) scale(1.03);
      filter: blur(6px) saturate(1.2);
    }
    100% {
      opacity: 0;
      transform: translateX(-60px) rotateY(-15deg) scale(1.05);
      filter: blur(10px) saturate(1.3);
    }
  }

  @keyframes luxury-scale-in {
    0% {
      opacity: 0;
      transform: scale(0.8) rotateZ(-5deg);
      filter: blur(15px) hue-rotate(30deg);
      box-shadow: 0 0 0 rgba(59, 130, 246, 0);
    }
    25% {
      opacity: 0.3;
      transform: scale(0.9) rotateZ(-2deg);
      filter: blur(10px) hue-rotate(15deg);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
    }
    50% {
      opacity: 0.6;
      transform: scale(0.95) rotateZ(-1deg);
      filter: blur(5px) hue-rotate(8deg);
      box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2);
    }
    75% {
      opacity: 0.9;
      transform: scale(1.02) rotateZ(0.5deg);
      filter: blur(2px) hue-rotate(3deg);
      box-shadow: 0 25px 50px rgba(59, 130, 246, 0.3);
    }
    100% {
      opacity: 1;
      transform: scale(1) rotateZ(0deg);
      filter: blur(0) hue-rotate(0deg);
      box-shadow: 0 30px 60px rgba(59, 130, 246, 0.4);
    }
  }

  @keyframes luxury-scale-out {
    0% {
      opacity: 1;
      transform: scale(1) rotateZ(0deg);
      filter: blur(0) hue-rotate(0deg);
      box-shadow: 0 30px 60px rgba(59, 130, 246, 0.4);
    }
    25% {
      opacity: 0.9;
      transform: scale(1.02) rotateZ(0.5deg);
      filter: blur(2px) hue-rotate(-3deg);
      box-shadow: 0 25px 50px rgba(59, 130, 246, 0.3);
    }
    50% {
      opacity: 0.6;
      transform: scale(1.05) rotateZ(1deg);
      filter: blur(5px) hue-rotate(-8deg);
      box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2);
    }
    75% {
      opacity: 0.3;
      transform: scale(1.1) rotateZ(2deg);
      filter: blur(10px) hue-rotate(-15deg);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
    }
    100% {
      opacity: 0;
      transform: scale(1.2) rotateZ(5deg);
      filter: blur(15px) hue-rotate(-30deg);
      box-shadow: 0 0 0 rgba(59, 130, 246, 0);
    }
  }

  /* SPECTACULAR PAGE TRANSITION ANIMATIONS */
  ::view-transition-old(root) {
    animation: spectacular-exit 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1;
  }

  ::view-transition-new(root) {
    animation: spectacular-entrance 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.2s both;
    z-index: 2;
  }

  /* DRAMATIC MAIN CONTENT TRANSITIONS */
  ::view-transition-old(main-content) {
    animation: dramatic-slide-out 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    transform-origin: center center;
  }

  ::view-transition-new(main-content) {
    animation: dramatic-slide-in 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.3s both;
    transform-origin: center center;
  }

  /* CINEMATIC HEADER TRANSITIONS */
  ::view-transition-old(site-header) {
    animation: cinematic-fade-out 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  ::view-transition-new(site-header) {
    animation: cinematic-fade-in 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.4s both;
  }

  /* ELEGANT FOOTER TRANSITIONS */
  ::view-transition-old(site-footer) {
    animation: elegant-scale-out 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  ::view-transition-new(site-footer) {
    animation: elegant-scale-in 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.5s both;
  }

  /* Premium Loading Bar with Particle Effects */
  [data-astro-transition] {
    position: relative;
  }

  [data-astro-transition]::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(59, 130, 246, 0.3) 20%,
      rgba(6, 182, 212, 0.8) 40%,
      rgba(139, 92, 246, 1) 50%,
      rgba(6, 182, 212, 0.8) 60%,
      rgba(59, 130, 246, 0.3) 80%,
      transparent 100%
    );
    background-size: 200% 100%;
    animation: premium-loading-bar 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
    z-index: 9999;
    pointer-events: none;
    box-shadow:
      0 0 20px rgba(59, 130, 246, 0.5),
      0 0 40px rgba(6, 182, 212, 0.3),
      0 0 60px rgba(139, 92, 246, 0.2);
  }

  [data-astro-transition]::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg,
      transparent,
      rgba(255, 255, 255, 0.8),
      transparent
    );
    animation: shimmer-effect 2s ease-in-out infinite;
    z-index: 10000;
    pointer-events: none;
  }

  @keyframes premium-loading-bar {
    0% {
      transform: translateX(-100%);
      background-position: 0% 50%;
    }
    50% {
      transform: translateX(0%);
      background-position: 100% 50%;
    }
    100% {
      transform: translateX(100%);
      background-position: 200% 50%;
    }
  }

  @keyframes shimmer-effect {
    0%, 100% {
      opacity: 0;
      transform: translateX(-100%) scaleX(0);
    }
    50% {
      opacity: 1;
      transform: translateX(0%) scaleX(1);
    }
  }

  /* ========================================
     SPECTACULAR PAGE TRANSITION KEYFRAMES
  ======================================== */

  @keyframes spectacular-exit {
    0% {
      opacity: 1;
      transform: scale(1) rotateY(0deg) rotateX(0deg);
      filter: blur(0px) brightness(1) contrast(1);
    }
    25% {
      opacity: 0.8;
      transform: scale(1.02) rotateY(-2deg) rotateX(1deg);
      filter: blur(2px) brightness(1.1) contrast(1.1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.05) rotateY(-5deg) rotateX(3deg);
      filter: blur(8px) brightness(1.3) contrast(1.2);
    }
    75% {
      opacity: 0.2;
      transform: scale(1.1) rotateY(-10deg) rotateX(5deg);
      filter: blur(15px) brightness(1.5) contrast(1.3);
    }
    100% {
      opacity: 0;
      transform: scale(1.2) rotateY(-15deg) rotateX(8deg);
      filter: blur(25px) brightness(2) contrast(1.5);
    }
  }

  @keyframes spectacular-entrance {
    0% {
      opacity: 0;
      transform: scale(0.8) rotateY(15deg) rotateX(-8deg);
      filter: blur(25px) brightness(0.5) contrast(0.5);
    }
    25% {
      opacity: 0.2;
      transform: scale(0.9) rotateY(10deg) rotateX(-5deg);
      filter: blur(15px) brightness(0.7) contrast(0.7);
    }
    50% {
      opacity: 0.5;
      transform: scale(0.95) rotateY(5deg) rotateX(-3deg);
      filter: blur(8px) brightness(0.8) contrast(0.8);
    }
    75% {
      opacity: 0.8;
      transform: scale(0.98) rotateY(2deg) rotateX(-1deg);
      filter: blur(2px) brightness(0.9) contrast(0.9);
    }
    100% {
      opacity: 1;
      transform: scale(1) rotateY(0deg) rotateX(0deg);
      filter: blur(0px) brightness(1) contrast(1);
    }
  }

  @keyframes dramatic-slide-out {
    0% {
      opacity: 1;
      transform: translateX(0) scale(1) rotateZ(0deg);
      filter: blur(0px) saturate(1) hue-rotate(0deg);
    }
    30% {
      opacity: 0.7;
      transform: translateX(-20px) scale(1.02) rotateZ(-1deg);
      filter: blur(3px) saturate(1.2) hue-rotate(10deg);
    }
    60% {
      opacity: 0.4;
      transform: translateX(-50px) scale(1.05) rotateZ(-3deg);
      filter: blur(8px) saturate(1.5) hue-rotate(20deg);
    }
    100% {
      opacity: 0;
      transform: translateX(-100px) scale(1.1) rotateZ(-5deg);
      filter: blur(20px) saturate(2) hue-rotate(30deg);
    }
  }

  @keyframes dramatic-slide-in {
    0% {
      opacity: 0;
      transform: translateX(100px) scale(0.9) rotateZ(5deg);
      filter: blur(20px) saturate(0.5) hue-rotate(-30deg);
    }
    40% {
      opacity: 0.4;
      transform: translateX(50px) scale(0.95) rotateZ(3deg);
      filter: blur(8px) saturate(0.7) hue-rotate(-20deg);
    }
    70% {
      opacity: 0.7;
      transform: translateX(20px) scale(0.98) rotateZ(1deg);
      filter: blur(3px) saturate(0.8) hue-rotate(-10deg);
    }
    100% {
      opacity: 1;
      transform: translateX(0) scale(1) rotateZ(0deg);
      filter: blur(0px) saturate(1) hue-rotate(0deg);
    }
  }

  @keyframes cinematic-fade-out {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0px) brightness(1);
    }
    50% {
      opacity: 0.5;
      transform: translateY(-10px) scale(1.03);
      filter: blur(5px) brightness(1.2);
    }
    100% {
      opacity: 0;
      transform: translateY(-20px) scale(1.06);
      filter: blur(12px) brightness(1.5);
    }
  }

  @keyframes cinematic-fade-in {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.94);
      filter: blur(12px) brightness(0.5);
    }
    50% {
      opacity: 0.5;
      transform: translateY(10px) scale(0.97);
      filter: blur(5px) brightness(0.8);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0px) brightness(1);
    }
  }

  @keyframes elegant-scale-out {
    0% {
      opacity: 1;
      transform: scale(1) rotateX(0deg);
      filter: blur(0px) contrast(1);
    }
    100% {
      opacity: 0;
      transform: scale(0.8) rotateX(15deg);
      filter: blur(15px) contrast(1.5);
    }
  }

  @keyframes elegant-scale-in {
    0% {
      opacity: 0;
      transform: scale(1.2) rotateX(-15deg);
      filter: blur(15px) contrast(0.5);
    }
    100% {
      opacity: 1;
      transform: scale(1) rotateX(0deg);
      filter: blur(0px) contrast(1);
    }
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    ::view-transition-old(*),
    ::view-transition-new(*) {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
    }

    [data-astro-transition]::before {
      display: none !important;
    }
  }

  /* Custom animations following Hero patterns */
  @keyframes animate-pulse-slow {
    0%, 100% {
      opacity: 0.6;
      transform: scale(1);
    }
    50% {
      opacity: 0.8;
      transform: scale(1.05);
    }
  }

  @keyframes animate-float-slow {
    0%, 100% {
      transform: translateY(0px) rotate(0deg);
    }
    25% {
      transform: translateY(-10px) rotate(90deg);
    }
    50% {
      transform: translateY(-5px) rotate(180deg);
    }
    75% {
      transform: translateY(-15px) rotate(270deg);
    }
  }

  .animate-pulse-slow {
    animation: animate-pulse-slow 8s ease-in-out infinite;
  }

  .animate-float-slow {
    animation: animate-float-slow 20s ease-in-out infinite;
  }

  /* Enhanced diagonal grid pattern following Hero style */
  .diagonal-grid {
    background-image:
      linear-gradient(45deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px),
      linear-gradient(-45deg, rgba(6, 182, 212, 0.02) 1px, transparent 1px);
    background-size: 20px 20px;
    background-position: 0 0, 10px 10px;
    animation: grid-move 30s linear infinite;
  }

  @keyframes grid-move {
    0% {
      transform: translate(0, 0);
    }
    100% {
      transform: translate(20px, 20px);
    }
  }

  /* Mobile viewport fixes */
  @media (max-width: 768px) {
    html, body {
      min-height: 100vh !important;
      min-height: 100svh !important;
      height: auto;
      overflow-x: hidden;
    }

    body > div {
      min-height: 100vh !important;
      min-height: 100svh !important;
    }

    /* Optimize grid pattern for mobile */
    .diagonal-grid {
      background-size: 15px 15px;
      background-position: 0 0, 7.5px 7.5px;
    }

    @keyframes grid-move {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(15px, 15px);
      }
    }
  }

  /* Further mobile optimizations for <400px */
  @media (max-width: 400px) {
    .diagonal-grid {
      background-size: 12px 12px;
      background-position: 0 0, 6px 6px;
      opacity: 0.3 !important;
    }

    @keyframes grid-move {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(12px, 12px);
      }
    }
  }
</style>
