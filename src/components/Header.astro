---
// Header.astro
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 ease-out bg-transparent lg:py-4 lg:px-4 lg:mx-4 lg:mt-4 lg:rounded-xl shadow-none border border-transparent backdrop-blur-none" transition:name="main-header">
  <nav class="w-full px-4 lg:container lg:mx-auto lg:px-8">
    <div class="flex justify-between items-center h-16 lg:h-14">
      <!-- Logo -->
      <div class="flex items-center space-x-2 lg:space-x-3" transition:name="logo-section">
        <img src="/pipe_logo.svg" alt="HYDRA²¹ Logo" class="h-7 lg:h-9 w-auto" transition:name="logo-image" />
        <span class="font-bold text-white text-lg lg:text-xl tracking-tight">
          <span class="gradient-text-blue-cyan" transition:name="logo-text">HYDRA²¹</span>
        </span>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center space-x-6" transition:name="desktop-nav">
        <nav class="flex items-center space-x-6">
          <a href="/" class="text-gray-300 hover:text-white transition font-medium">Inicio</a>
          <a href="/about" class="text-gray-300 hover:text-white transition font-medium">Acerca de</a>
          <a href="/#caracteristicas" class="text-gray-300 hover:text-white transition font-medium">Caracteristicas</a>
          <a href="/#documentacion" class="text-gray-300 hover:text-white transition font-medium">Documentacion</a>
          <a href="/#contacto" class="text-gray-300 hover:text-white transition font-medium">Contacto</a>
        </nav>
      </div>

      <!-- Right Side -->
      <div class="flex items-center space-x-2 lg:space-x-3" transition:name="header-actions">
        <button class="hidden lg:flex items-center justify-center w-9 h-9 rounded-full bg-gray-800 hover:bg-gray-700 transition">
          <svg class="w-5 h-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        </button>
        <a href="/descargas" class="hidden min-[500px]:flex header-download-button">
          <span class="button__text">Descargar</span>
          <div class="button__icon">
            <svg class="button__svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
          </div>
        </a>
        <!-- Mobile Hamburger -->
        <label id="mobile-menu-button" class="lg:hidden flex flex-col gap-2 w-8 cursor-pointer" aria-label="Abrir menú" transition:name="mobile-menu-button">
          <input id="mobile-menu-checkbox" class="peer hidden" type="checkbox" />
          <div class="h-[3px] w-1/2 bg-white rounded duration-500 peer-checked:rotate-[225deg] origin-right peer-checked:-translate-x-[12px] peer-checked:-translate-y-[1px]"></div>
          <div class="h-[3px] w-full bg-white rounded duration-500 peer-checked:-rotate-45"></div>
          <div class="h-[3px] w-1/2 bg-white rounded duration-500 place-self-end peer-checked:rotate-[225deg] origin-left peer-checked:translate-x-[12px] peer-checked:translate-y-[1px]"></div>
        </label>
      </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div id="mobile-menu" class="lg:hidden hidden bg-black/95 border-t border-gray-800 lg:rounded-b-xl">
      <div class="px-4 pt-4 pb-6 space-y-4">
        <a href="/" class="block text-gray-300 hover:text-white transition-colors duration-200 font-medium py-2">
          Inicio
        </a>
        <a href="/about" class="block text-gray-300 hover:text-white transition-colors duration-200 font-medium py-2">
          Acerca de
        </a>
        <a href="#caracteristicas" class="block text-gray-300 hover:text-white transition-colors duration-200 font-medium py-2">
          Caracteristicas
        </a>
        <a href="#documentacion" class="block text-gray-300 hover:text-white transition-colors duration-200 font-medium py-2">
          Documentacion
        </a>
        <a href="#contacto" class="block text-gray-300 hover:text-white transition-colors duration-200 font-medium py-2">
          Contacto
        </a>

        <!-- Mobile Download Section -->
        <div class="pt-4 border-t border-gray-800">
          <a href="/descargas" class="flex items-center space-x-3 text-white bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 transition-all duration-300 py-3 px-4 rounded-lg hover:scale-105">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span>Descargar HYDRA²¹</span>
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  function initializeHeader() {
    const header = document.getElementById('site-header');
    let lastScrollY = window.scrollY;
    let ticking = false;
    let isHeaderHidden = false;

    if (header) {
      const updateHeader = () => {
        const currentScrollY = window.scrollY;
        const isDesktop = window.innerWidth >= 1024;

        // Simple sticky behavior
        if (currentScrollY > 20) {
          if (isDesktop) {
            // Desktop: floating card effect
            header.classList.remove('bg-transparent', 'lg:py-4', 'shadow-none', 'border-transparent', 'backdrop-blur-none');
            header.classList.add('bg-black/90', 'lg:py-2', 'shadow-2xl', 'border-gray-700', 'backdrop-blur-xl');
          } else {
            // Mobile: clean sticky header
            header.classList.remove('bg-transparent', 'shadow-none', 'border-transparent', 'backdrop-blur-none');
            header.classList.add('bg-black/95', 'shadow-xl', 'border-gray-700', 'backdrop-blur-xl');
          }
        } else {
          // Reset to transparent state
          if (isDesktop) {
            header.classList.remove('bg-black/90', 'lg:py-2', 'shadow-2xl', 'border-gray-700', 'backdrop-blur-xl');
            header.classList.add('bg-transparent', 'lg:py-4', 'shadow-none', 'border-transparent', 'backdrop-blur-none');
          } else {
            header.classList.remove('bg-black/95', 'shadow-xl', 'border-gray-700', 'backdrop-blur-xl');
            header.classList.add('bg-transparent', 'shadow-none', 'border-transparent', 'backdrop-blur-none');
          }
        }

        lastScrollY = currentScrollY;
        ticking = false;
      };

      const requestTick = () => {
        if (!ticking) {
          requestAnimationFrame(updateHeader);
          ticking = true;
        }
      };

      // Simple scroll listener for better performance
      window.addEventListener('scroll', () => {
        requestTick();
      }, { passive: true });
      
      // Handle window resize
      window.addEventListener('resize', () => {
        requestTick();
      });

      // Initialize header state
      updateHeader();
    }

    // Funcionalidad del menú móvil
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuCheckbox = document.getElementById('mobile-menu-checkbox') as HTMLInputElement;

    function closeMenu() {
      if (!mobileMenu || !mobileMenuCheckbox) return;
      
      setTimeout(() => {
        mobileMenu.classList.add('hidden');
        mobileMenuCheckbox.checked = false;
        document.body.style.overflow = '';
      }, 300);
    }

    if (mobileMenuButton && mobileMenu && mobileMenuCheckbox) {
      
      function openMenu() {
        if (!mobileMenu) return;
        
        mobileMenu.classList.remove('hidden');
        mobileMenuCheckbox.checked = true;
        
        // Animate menu items with stagger effect
        const menuItems = mobileMenu.querySelectorAll('a, button');
        menuItems.forEach((item, index) => {
          (item as HTMLElement).style.transitionDelay = `${index * 50}ms`;
        });
      }

      mobileMenuCheckbox.addEventListener('change', function() {
        if (this.checked) {
          openMenu();
        } else {
          closeMenu();
        }
      });

      // Close menu when clicking on links
      const menuLinks = mobileMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', closeMenu);
      });

      // Close menu when clicking outside
      document.addEventListener('click', function(event) {
        const target = event.target as HTMLElement;
        if (!mobileMenuButton.contains(target) && !mobileMenu.contains(target) && mobileMenuCheckbox.checked) {
          closeMenu();
        }
      });

      // Handle escape key
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && mobileMenuCheckbox.checked) {
          closeMenu();
        }
      });
    }
  }

  // Initialize on DOM content loaded AND after each page transition
  document.addEventListener('DOMContentLoaded', initializeHeader);
  document.addEventListener("astro:page-load", initializeHeader);
</script>

<style>
  /* Simplified header transitions */
  header {
    transition: background-color 0.2s ease, backdrop-filter 0.2s ease;
  }

  /* Mobile specific optimizations */
  @media (max-width: 1023px) {
    header {
      margin: 0 !important;
      border-radius: 0 !important;
      padding: 0 !important;
    }
  }

  .gradient-text-blue-cyan {
    background: linear-gradient(135deg, #60a5fa 0%, #06b6d4 50%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    background-size: 200% 100%;
    filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.3));
    animation: gradientShift 4s ease-in-out infinite;
  }

  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* Simple mobile menu */
  #mobile-menu {
    backdrop-filter: blur(10px);
  }

  /* Simple interactive elements */
  nav a {
    transition: color 0.2s ease;
  }

  /* Simple button hover effects */
  button {
    transition: color 0.2s ease;
  }

  /* Performance optimizations */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* ——————————————————————————————————————————————
     COOL HEADER DOWNLOAD BUTTON - BLUE THEME
  ————————————————————————————————————————————— */
  .header-download-button {
    position: relative;
    width: 150px;
    height: 40px;
    cursor: pointer;
    display: flex;
    align-items: center;
    border: 1px solid #1e3a8a;
    background-color: #2563eb;
    overflow: hidden;
    border-radius: 6px;
    text-decoration: none;
  }

  .header-download-button, 
  .header-download-button .button__icon, 
  .header-download-button .button__text {
    transition: all 0.3s ease;
  }

  .header-download-button .button__text {
    transform: translateX(22px);
    color: #ffffff;
    font-weight: 600;
    font-size: 14px;
  }

  .header-download-button .button__icon {
    position: absolute;
    transform: translateX(109px);
    height: 100%;
    width: 39px;
    background-color: #1e3a8a;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .header-download-button .button__svg {
    width: 20px;
    height: 20px;
    fill: none;
    stroke: #ffffff;
    stroke-width: 2;
  }

  .header-download-button:hover {
    background: #1e3a8a;
    transform: translateY(-1px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
  }

  .header-download-button:hover .button__text {
    color: transparent;
  }

  .header-download-button:hover .button__icon {
    width: 148px;
    transform: translateX(0);
  }

  .header-download-button:active .button__icon {
    background-color: #1e40af;
  }

  .header-download-button:active {
    border: 1px solid #1e40af;
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .header-download-button {
      width: 130px;
      height: 36px;
    }

    .header-download-button .button__text {
      font-size: 13px;
      transform: translateX(18px);
    }

    .header-download-button .button__icon {
      width: 34px;
      transform: translateX(94px);
    }

    .header-download-button:hover .button__icon {
      width: 128px;
    }

    .header-download-button .button__svg {
      width: 18px;
      height: 18px;
    }
  }
</style>